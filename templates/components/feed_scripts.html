<script>
function toggleAddPrayer() {
    const form = document.getElementById('add-prayer-form');
    const isVisible = form.style.display !== 'none';
    
    if (isVisible) {
        form.style.display = 'none';
    } else {
        form.style.display = 'block';
        // Focus on the textarea when opening
        setTimeout(() => {
            document.getElementById('text').focus();
        }, 100);
    }
}

// Handle prayer form submission with AJAX
document.addEventListener('DOMContentLoaded', function() {
    const prayerForm = document.getElementById('prayer-form');
    if (prayerForm) {
        prayerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const statusDiv = document.getElementById('prayer-status');
            const loadingDiv = document.getElementById('prayer-loading');
            const successDiv = document.getElementById('prayer-success');
            const errorDiv = document.getElementById('prayer-error');
            
            // Show loading state
            submitBtn.disabled = true;
            statusDiv.classList.remove('hidden');
            loadingDiv.classList.remove('hidden');
            successDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            
            try {
                const formData = new FormData(prayerForm);
                const response = await fetch('/prayers', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    // Show success message
                    loadingDiv.classList.add('hidden');
                    successDiv.classList.remove('hidden');
                    
                    // Reset form
                    prayerForm.reset();
                    
                    // Close form after 2 seconds and reload page to show new prayer
                    setTimeout(() => {
                        toggleAddPrayer();
                        window.location.reload();
                    }, 2000);
                } else {
                    throw new Error('Submission failed');
                }
            } catch (error) {
                // Show error message
                loadingDiv.classList.add('hidden');
                errorDiv.classList.remove('hidden');
                
                // Re-enable submit button after error
                setTimeout(() => {
                    submitBtn.disabled = false;
                    statusDiv.classList.add('hidden');
                }, 3000);
            }
        });
    }
});

// Invite modal functions
function closeInviteModal() {
    const modal = document.getElementById('invite-modal');
    if (modal) {
        modal.remove();
    }
}

function copyInviteLink(url) {
    navigator.clipboard.writeText(url).then(function() {
        // Show temporary success feedback
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'âœ“ Copied!';
        button.classList.remove('bg-purple-600', 'hover:bg-purple-700');
        button.classList.add('bg-green-600', 'hover:bg-green-700');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-600', 'hover:bg-green-700');
            button.classList.add('bg-purple-600', 'hover:bg-purple-700');
        }, 2000);
    }).catch(function() {
        // Fallback: select the text for manual copying
        const linkElement = document.querySelector('#invite-modal a');
        if (linkElement) {
            const range = document.createRange();
            range.selectNode(linkElement);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
        }
    });
}

// Close modal when clicking on backdrop
document.addEventListener('click', function(event) {
    const modal = document.getElementById('invite-modal');
    if (modal && event.target === modal) {
        closeInviteModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeInviteModal();
    }
});
</script>