<!-- Prayer Feed Navigation -->
<section class="mb-6">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-1 relative">
    <!-- Scroll indicators for desktop -->
    <div class="feed-nav-indicators hidden lg:flex absolute inset-y-0 pointer-events-none z-10">
      <div id="scrollLeft" class="scroll-indicator left flex items-center justify-center w-8 h-full bg-gradient-to-r from-white dark:from-gray-800 to-transparent opacity-0 transition-opacity duration-300">
        <span class="text-gray-400 dark:text-gray-500 text-sm">‚Äπ</span>
      </div>
      <div id="scrollRight" class="scroll-indicator right flex items-center justify-center w-8 h-full bg-gradient-to-l from-white dark:from-gray-800 to-transparent opacity-0 transition-opacity duration-300 ml-auto">
        <span class="text-gray-400 dark:text-gray-500 text-sm">‚Ä∫</span>
      </div>
    </div>
    
    <nav id="feedNavigation" class="feed-nav-scroll flex overflow-x-auto scrollbar-hide space-x-1" style="scrollbar-width: none; -ms-overflow-style: none;">
      <style>
        .scrollbar-hide::-webkit-scrollbar {
          display: none;
        }
        .scroll-indicator.left {
          left: 0;
        }
        .scroll-indicator.right {
          right: 0;
        }
        .feed-nav-scroll {
          scroll-behavior: smooth;
        }
      </style>
      {% set nav_base = "flex-shrink-0 inline-flex items-center gap-1.5 px-2 py-1.5 text-sm font-medium rounded-md transition-all duration-200" %}
      {% set nav_inactive = "text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 hover:bg-gray-50 dark:hover:bg-gray-700" %}
      {% set nav_active_all = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_daily = "bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-200 shadow-sm" %}
      {% set nav_active_attention = "bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-200 shadow-sm" %}
      {% set nav_active_new = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_most = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_my_prayers = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_my_unprayed = "bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200 shadow-sm" %}
      {% set nav_active_my_requests = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_recent = "bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200 shadow-sm" %}
      {% set nav_active_answered = "bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200 shadow-sm" %}
      {% set nav_active_archived = "bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-200 shadow-sm" %}
      
      <a href="/feed?feed_type=all"
         class="{{ nav_base }} {% if current_feed == 'all' %}{{ nav_active_all }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="all"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_all }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'all' %}page{% else %}false{% endif %}">
        <span>All</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'all' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.all or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=daily_prayer"
         class="{{ nav_base }} {% if current_feed == 'daily_prayer' %}{{ nav_active_daily }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="daily_prayer"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_daily }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'daily_prayer' %}page{% else %}false{% endif %}">
        <span>‚≠ê Daily Priority</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'daily_prayer' %}bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.daily_prayer or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=prayers_needing_attention"
         class="{{ nav_base }} {% if current_feed == 'prayers_needing_attention' %}{{ nav_active_attention }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="prayers_needing_attention"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_attention }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'prayers_needing_attention' %}page{% else %}false{% endif %}">
        <span>üïê Need Attention</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'prayers_needing_attention' %}bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.prayers_needing_attention or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=new_unprayed"
         class="{{ nav_base }} {% if current_feed == 'new_unprayed' %}{{ nav_active_new }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="new_unprayed"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_new }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'new_unprayed' %}page{% else %}false{% endif %}">
        <span>New</span>
        {% if feed_counts.new_unprayed > 0 %}
          <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-full animate-pulse">{{ feed_counts.new_unprayed }}</span>
        {% else %}
          <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'new_unprayed' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">0</span>
        {% endif %}
      </a>
      
      <a href="/feed?feed_type=most_prayed"
         class="{{ nav_base }} {% if current_feed == 'most_prayed' %}{{ nav_active_most }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="most_prayed"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_most }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'most_prayed' %}page{% else %}false{% endif %}">
        <span>Popular</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'most_prayed' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.most_prayed or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=my_prayers"
         class="{{ nav_base }} {% if current_feed == 'my_prayers' %}{{ nav_active_my_prayers }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="my_prayers"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_my_prayers }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'my_prayers' %}page{% else %}false{% endif %}">
        <span>My Prayers</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'my_prayers' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.my_prayers or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=my_unprayed"
         class="{{ nav_base }} {% if current_feed == 'my_unprayed' %}{{ nav_active_my_unprayed }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="my_unprayed"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_my_unprayed }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'my_unprayed' %}page{% else %}false{% endif %}">
        <span>üîç Not Prayed Yet</span>
        {% if feed_counts.my_unprayed > 0 %}
          <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded-full">{{ feed_counts.my_unprayed }}</span>
        {% else %}
          <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'my_unprayed' %}bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">0</span>
        {% endif %}
      </a>
      
      <a href="/feed?feed_type=my_requests"
         class="{{ nav_base }} {% if current_feed == 'my_requests' %}{{ nav_active_my_requests }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="my_requests"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_my_requests }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'my_requests' %}page{% else %}false{% endif %}">
        <span>My Prayer Requests</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'my_requests' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.my_requests or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=recent_activity"
         class="{{ nav_base }} {% if current_feed == 'recent_activity' %}{{ nav_active_recent }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="recent_activity"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_recent }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'recent_activity' %}page{% else %}false{% endif %}">
        <span>Recent</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'recent_activity' %}bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.recent_activity or 0 }}</span>
      </a>
      
      <a href="/feed?feed_type=answered"
         class="{{ nav_base }} {% if current_feed == 'answered' %}{{ nav_active_answered }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="answered"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_answered }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'answered' %}page{% else %}false{% endif %}"
         title="View praise reports - click for celebration page!"
         oncontextmenu="window.location.href='/answered'; return false;">
        <span>üôè Praise Reports</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'answered' %}bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.answered or 0 }}</span>
      </a>
      
      {% if feed_counts.archived > 0 %}
      <a href="/feed?feed_type=archived"
         class="{{ nav_base }} {% if current_feed == 'archived' %}{{ nav_active_archived }}{% else %}{{ nav_inactive }}{% endif %}"
         data-feed-type="archived"
         data-base-class="{{ nav_base }}"
         data-active-class="{{ nav_active_archived }}"
         data-inactive-class="{{ nav_inactive }}"
         aria-current="{% if current_feed == 'archived' %}page{% else %}false{% endif %}">
        <span>üìÅ Archived</span>
        <span class="inline-flex items-center justify-center w-4 h-4 text-xs font-semibold {% if current_feed == 'archived' %}bg-amber-200 dark:bg-amber-800 text-amber-800 dark:text-amber-100{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300{% endif %} rounded-full">{{ feed_counts.archived }}</span>
      </a>
      {% endif %}
    </nav>
  </div>
  
  <!-- Scroll hint for mobile -->
  <div class="flex justify-center mt-2 sm:hidden">
    <div class="text-xs text-gray-400 dark:text-gray-500 bg-gray-50 dark:bg-gray-800 px-2 py-1 rounded-full">
      ‚Üê Swipe to see more tabs ‚Üí
    </div>
  </div>

  <!-- Desktop scrolling functionality -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const nav = document.getElementById('feedNavigation');
    const leftIndicator = document.getElementById('scrollLeft');
    const rightIndicator = document.getElementById('scrollRight');
    const scrollStorageKey = 'thywill_feed_nav_scroll';
    
    if (!nav || !leftIndicator || !rightIndicator) return;
    
    // Mouse wheel horizontal scrolling for desktop
    nav.addEventListener('wheel', function(e) {
      // Only handle horizontal scrolling
      if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
        e.preventDefault();
        nav.scrollLeft += e.deltaY;
      }
    }, { passive: false });

    // Update scroll indicators
    function updateScrollIndicators() {
      const canScrollLeft = nav.scrollLeft > 0;
      const canScrollRight = nav.scrollLeft < (nav.scrollWidth - nav.clientWidth);
      
      // Show left indicator if can scroll left
      leftIndicator.style.opacity = canScrollLeft ? '0.8' : '0';
      
      // Show right indicator if can scroll right  
      rightIndicator.style.opacity = canScrollRight ? '0.8' : '0';
    }

    function clampScroll(value) {
      return Math.max(0, Math.min(value, nav.scrollWidth - nav.clientWidth));
    }

    function focusNavLink(link) {
      if (!link) {
        return;
      }
      const linkRect = link.getBoundingClientRect();
      const navRect = nav.getBoundingClientRect();
      const offset = linkRect.left - navRect.left;
      const target = nav.scrollLeft + offset - (nav.clientWidth - linkRect.width) / 2;
      nav.scrollLeft = clampScroll(target);
      const adjustedRect = link.getBoundingClientRect();
      if (adjustedRect.left < navRect.left) {
        nav.scrollLeft = clampScroll(nav.scrollLeft + (adjustedRect.left - navRect.left) - 8);
      } else if (adjustedRect.right > navRect.right) {
        nav.scrollLeft = clampScroll(nav.scrollLeft + (adjustedRect.right - navRect.right) + 8);
      }
      updateScrollIndicators();
      sessionStorage.setItem(scrollStorageKey, String(nav.scrollLeft || 0));
    }

    const storedScroll = sessionStorage.getItem(scrollStorageKey);
    const activeLink = nav.querySelector('a[aria-current="page"]');
    requestAnimationFrame(function () {
      if (storedScroll !== null) {
        const value = clampScroll(parseInt(storedScroll, 10) || 0);
        nav.scrollLeft = value;
        updateScrollIndicators();
        sessionStorage.removeItem(scrollStorageKey);
      } else if (activeLink && typeof activeLink.scrollIntoView === 'function') {
        focusNavLink(activeLink);
        return;
      }
    });

    nav.addEventListener('click', function (event) {
      const link = event.target.closest('a[data-feed-type]');
      if (!link) {
        return;
      }
      const linkRect = link.getBoundingClientRect();
      const navRect = nav.getBoundingClientRect();
      const offset = linkRect.left - navRect.left;
      const desired = nav.scrollLeft + offset - (nav.clientWidth - linkRect.width) / 2;
      const clamped = clampScroll(desired);
      sessionStorage.setItem(scrollStorageKey, String(clamped));
    }, true);

    // Initialize and update indicators on scroll
    nav.addEventListener('scroll', updateScrollIndicators);
    window.addEventListener('resize', updateScrollIndicators);

    // Initial check
    setTimeout(updateScrollIndicators, 100);
  });
  </script>
</section>
